<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>Basic Table </title>

    <!-- Bootstrap CSS -->
    <link href="Bootstrap/bootstrap_admin/css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="Bootstrap/bootstrap_admin/css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="Bootstrap/bootstrap_admin/css/elegant-icons-style.css" rel="stylesheet" />
    <link href="Bootstrap/bootstrap_admin/css/font-awesome.min.css" rel="stylesheet" />
    <!-- Custom styles -->
    <link href="Bootstrap/bootstrap_admin/css/style.css" rel="stylesheet">
    <link href="Bootstrap/bootstrap_admin/css/style-responsive.css" rel="stylesheet" />
</head>

<body>
    <!-- container section start -->
    <section id="container" class="">

        <!--header start-->
        <header class="header dark-bg">
            <div class="toggle-nav">
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i
                        class="icon_menu"></i></div>
            </div>

            <!--logo start-->
            <a href="/" class="logo">EDU <span class="lite">CENTER</span></a>
            <!--logo end-->



            <div class="top-nav notification-row">
                <!-- notificatoin dropdown start-->
                <ul class="nav pull-right top-menu">

                    <!-- alert notification start-->
                   
                    <!-- alert notification end-->
                    <!-- user login dropdown start-->
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="profile-ava">
                                <img alt="" src="img/avatar1_small.jpg">
                            </span>
                            <span class="username"><%=taiKhoan.tenThanhVien%></span>
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu extended logout">
                            <div class="log-arrow-up"></div>
                            <li class="eborder-top">
                                <a href="/thongtingiaovien"><i class="icon_profile"></i> Thông tin cá nhân</a>
                            </li>
                            <li>
                                <a href="/logoutGV"><i class="icon_key_alt"></i> Đăng xuất</a>
                            </li>
                        </ul>
                    </li>
                    <!-- user login dropdown end -->
                </ul>
                <!-- notificatoin dropdown end-->
            </div>
        </header>
        <!--header end-->
        <!--sidebar start-->
        <aside>
            <div id="sidebar" class="nav-collapse ">
                <!-- sidebar menu start-->
                <ul class="sidebar-menu">

                        <li class="">
                                <a class="" href="/danhsachkhoahoc">
                                    <i class="icon_house_alt"></i>
                                    <span>Danh sách khóa học</span>
                                </a>
                            </li>
                            <li class="">
                                <a class="" href="/danhsachchuakiemduyet">
                                    <span>Danh sách chưa kiểm duyệt</span>
                                </a>
                            </li>
                            <li class="">
                                    <a class="" href="/danhsachkhonghople">
                                        <span>Danh sách không hợp lệ</span>
                                    </a>
                                </li>
                </ul>
                <!-- sidebar menu end-->
            </div>
        </aside>

        <!--main content start-->
        <section id="main-content">
            <section class="wrapper">
                <div class="row">
                    <div class="col-lg-12">
                        <h3 class="page-header"><i class="fa fa-th"></i>Thêm khóa học</h3>
                    </div>
                </div>
                <!-- page start-->
                <input type="number" id="lenghtArray" hidden="true" value="<%=listBaiHoc.length%>">

                <section class="panel">
                    <header class="panel-heading">
                        Thông tin khóa học
                    </header>
                    <div class="panel-body">
                        <div class="form">
                            <form class="form-validate form-horizontal" id="form_register" method="POST"
                                action="/capnhat" encType="multipart/form-data">
                                <div class="form-group ">
                                    <label for="cname" class="control-label col-lg-2">Mã khóa học</label>
                                    <div class="col-lg-10">
                                        <input readonly="true" class="form-control" id="makhoahoc" name="maKhoaHoc"
                                            minlength="5" type="text" value="<%=listBaiHoc[0].maKhoaHoc%>" />
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label for="cname" class="control-label col-lg-2">Tựa khóa học</label>
                                    <div class="col-lg-10">
                                        <input class="form-control" id="tuakhoahoc" name="tuakhoahoc" minlength="5"
                                            type="text" value="<%=listBaiHoc[0].tenKhoaHoc%>" />
                                        <span id="tuakhoahoc_err"></span>
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label for="cname" class="control-label col-lg-2">Ảnh đại diện</label>
                                    <div class="col-lg-2">
                                        <input type="file" id="anhdaidien" name="anhdaidien">
                                        <span id="anhdaidien_err"></span>
                                    </div>
                                    <div class="col-lg-8">
                                        <span ><img id="image_upload_preview" src="<%=listBaiHoc[0].anhDaiDien%>" width="60" height="60"></span>
                                    </div>

                                </div>
                                <div class="form-group ">
                                    <label for="cname" class="control-label col-lg-2">Danh muc</label>
                                    <div class="col-lg-10">
                                        <select class="form-control" name="danhMuc">
                                            <option value="toan">Toán</option>
                                            <option value="lich_su">Lịch sử</option>
                                            <option value="dia_li">Địa lí</option>
                                            <option value="hoa_hoc">Hóa học</option>
                                            <option value="van_hoc">Văn học</option>
                                            <option value="gdcd">Giáo dục công dân</option>
                                            <option value="sinh_hoc">Sinh học</option>
                                            <option value="anh_van">Anh văn</option>
                                            <option value="tin_hoc">Tin học</option>
                                        </select>
                                        <br>
                                    </div>

                                    <div class="form-group ">
                                        <label for="curl" class="control-label col-lg-2">Giá khóa học</label>
                                        <div class="col-lg-10">
                                            <input class="form-control " id="giakhoahoc" type="number" name="giakhoahoc"
                                                value="<%=listBaiHoc[0].giaKhoaHoc%>" />
                                            <span id="giakhoahoc_err"></span>
                                        </div>
                                    </div>
                                    <div class="form-group ">
                                        <label for="ccomment" class="control-label col-lg-2">Mô tả</label>
                                        <div class="col-lg-10">
                                            <textarea class="form-control " id="mota" name="mota"
                                                required><%=listBaiHoc[0].moTaKhoaHoc%></textarea>
                                            <span id="mota_err"></span>
                                        </div>
                                    </div>

                                    <div class="input_fields_wrap"
                                        style="border: 1px solid bisque;box-shadow:2px 1px 2px 3px #888888; margin-bottom: 50px;">
                                        <button style="margin-bottom: 20px;" type="button" class="add_field_button btn btn-primary">Thêm bài học</button>
                                    <button style="margin-bottom: 20px;" type="button" class="delete_button btn btn-primary">Xóa</button>
                                        <div><input style="display: none;" type="text" name="tenbaihoc"></div>
                                        <span id="soluong_err"></span>
                                       
                                        <% for (var i = 1; i <= listBaiHoc.length; i++) { %>
                                        <div id="div<%=i%>" style="margin-bottom:15px;">
                                            <input style="border: 1px solid black;" type="text" required="true"
                                                name="tenBaiHoc<%=i - 1%>" value="<%=listBaiHoc[i-1].tenBaiHoc%>" />
                                            <input style="border: 1px solid black;" type="text" name="moTa<%=i - 1%>"
                                                value="<%=listBaiHoc[i-1].moTaBaiHoc%>" required="true" />
                                            <input id="url<%=i - 1%>" type="file" class="form-control" name="url<%=i - 1%>"
                                                value="ddasđs"  accept="video/mp4,video/x-m4v,video"/>
                                                <span ><video id="video_upload_preview<%=i - 1%>" src="<%=listBaiHoc[i-1].url%>" width="60" height="60"></video></span>
                                            <input  type="text" name="maBaiHoc<%=i - 1%>"value="<%=listBaiHoc[i-1].maBaiHoc%>"  />
                                        </div>
                                        <% } %>
                                    </div>
                                    <div class="row">


                                        <div class="form-group">
                                            <div class="col-lg-offset-9 col-lg-4">
                                                <input class="btn btn-primary" type="submit" value="Lưu" />

                                                <%if(listBaiHoc[0].trangThaiKhoaHoc == 'true'){%>
                                                <a href="/an?maKhoaHoc=<%=listBaiHoc[0].maKhoaHoc%>"><button
                                                        type="button" class="btn btn-danger">Ẩn</button></a>
                                                <%}%>
                                                <%if(listBaiHoc[0].trangThaiKhoaHoc == 'false'){%>
                                                <a href="/hien?maKhoaHoc=<%=listBaiHoc[0].maKhoaHoc%>"><button
                                                        type="button" class="btn btn-success">Hiện</button></a>

                                                <%}%>
                                                <a href="/huy"><button type="button" class="btn btn-success">Hủy</button></a>

                                        </div>
                                    </div>
                                </div>
                                <!-- page end-->
                               
                            </form>
                        </div>

                    </div>
                </section>

            </section>
        </section>
    </section>
    
    <!-- container section end -->
    <!-- javascripts -->
    <script src="Bootstrap/bootstrap_admin/js/jquery.js"></script>
    <script src="Bootstrap/bootstrap_admin/js/bootstrap.min.js"></script>
    <!-- nicescroll -->
    <script src="Bootstrap/bootstrap_admin/js/jquery.scrollTo.min.js"></script>
    <script src="Bootstrap/bootstrap_admin/js/jquery.nicescroll.js" type="text/javascript"></script>
    <!--custome script for all page-->
    <script src="Bootstrap/bootstrap_admin/js/scripts.js"></script>

    <script src="javascripts/jquery.dynamicTable-1.0.0.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" crossorigin="anonymous"></script>
    <script>

        $(document).ready(function () {
            var max_fields = 100; //maximum input boxes allowed
            var wrapper = $(".input_fields_wrap"); //Fields wrapper
            var add_button = $(".add_field_button"); //Add button ID
            var delete_button = $(".delete_button");
            var lenght = $('#lenghtArray').val();
            console.log(lenght);
            var x = Number(lenght); //initlal text box count
            $(add_button).click(function (e) { //on add input button click
                e.preventDefault();
                let maBaiHocRan = Math.floor(Math.random() * 999999999);
                if (x < max_fields) { //max input box allowed
                    x++; //text box increment
                    //Nếu load gì load trên này .
                    $(wrapper).append('<div id="div' + String(x) + '" style="margin-bottom:15px;"> <input style="border: 1px solid black;" type="text"  required="true" name="tenBaiHoc' + (x - 1).toString(10) + '" placeholder="Tên bài học."/> <input style="border: 1px solid black;" type="text" name="moTa' + (x - 1).toString(10) + '" placeholder="Mô tả bài học."/>  <input type="file" id="url' + (x - 1).toString(10) + '" class="form-control" name="url' + (x - 1).toString(10) + '" placeholder="Chọn file." required="true" /><span ><video id="video_upload_preview' + (x - 1).toString(10) + '" name="video_upload_preview' + (x - 1).toString(10) + '" src="#" width="60" height="60"></video></span><input type="text" name="maBaiHoc'+(x - 1).toString(10)+'" value="'+String(maBaiHocRan + x)+'" hidden="true" /></div>'); //add input box
                    consolel.log(x - 1);
                }
            });
           
            $(delete_button).click(function (event) {
                event.preventDefault();
                if (x > 0) {
                    console.log(x);
                    $('#div' + String(x)).remove();
                    x--;
                }
            });
            $('#form_register').submit(function () {

                // BƯỚC 1: Lấy dữ liệu từ form
                var tuakhoahoc = $.trim($('#tuakhoahoc').val());
                var giakhoahoc = $.trim($('#giakhoahoc').val());
                var mota = $.trim($('#mota').val());
                var anhdaidien = $.trim($('#anhdaidien').val());

                // BƯỚC 2: Validate dữ liệu
                // Biến cờ hiệu
                var flag = true;

                // Username
                if (tuakhoahoc == '') {
                    $('#tuakhoahoc_err').text('Tựa khóa học không được rỗng');
                    flag = false;
                }
                else {
                    $('#tuakhoahoc_err').text('');
                }
                if (giakhoahoc == '') {
                    $('#giakhoahoc_err').text('Nhập giá khóa học');
                    flag = false;
                }
                else {
                    $('#giakhoahoc_err').text('');
                }
                if (mota == '') {
                    $('#mota_err').text('Nhập mô tả');
                    flag = false;
                }
                else {
                    $('#mota_err').text('');
                }
               
                if (x  < 2) {
                    $('#soluong_err').text('Khóa họ phải có ít nhất 2 bài học');
                    flag = false;
                }
                else {
                    $('#soluong_err').text('');
                }
                 return flag;
            });
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#image_upload_preview').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#anhdaidien").change(function () {
                readURL(this);
            });
            $("#anhdaidien").change(function () {
                var fileExtension = ['jpeg', 'jpg', 'png'];
                if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                    $('#anhdaidien_err').text('Ảnh đại diện phải là jpeg, jpg, png');
                }
            });
            function readVideo(input, i) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#video_upload_preview'+ String(i)).attr('src', e.target.result);
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            for(let i = 0; i < 100; i ++){
                $("#url" + String(i)).change(function () {
                    readVideo(this, i);
                });
            }
           
            
            
        });
    </script> 

    </body> 
    </html>